<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ è´ªåƒè›‡å¤§ä½œæˆ˜ - CSTçš„ä¸“å±ç½‘é¡µ</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="shortcut icon" href="favicon.png" type="image/png">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #ffeb3b;
            margin: 0;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .game-container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 15px;
        }

        .score-item {
            background: rgba(255,215,0,0.2);
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            flex: 1;
            min-width: 120px;
        }

        .score-item div {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .game-status {
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffeb3b;
            min-height: 30px;
        }

        #gameCanvas {
            border: 3px solid #ffeb3b;
            border-radius: 10px;
            background: #111;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: block;
            margin: 0 auto;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .control-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .control-button:disabled {
            background: linear-gradient(45deg, #666, #555);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .instructions {
            margin-top: 25px;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.6;
            text-align: left;
        }

        .instructions h3 {
            color: #ffeb3b;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 600px) {
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .score-item {
                min-width: auto;
            }
            
            #gameCanvas {
                width: 300px !important;
                height: 300px !important;
            }
            
            .control-button {
                padding: 12px 20px;
                font-size: 14px;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">â† è¿”å›ä¸»é¡µ</a>
    
    <div class="header">
        <h1>ğŸ è´ªåƒè›‡å¤§ä½œæˆ˜</h1>
        <p>æ§åˆ¶å°è›‡åƒé£Ÿç‰©ï¼Œè¶Šé•¿è¶Šå‰å®³ï¼</p>
    </div>

    <div class="game-container">
        <div class="game-info">
            <div class="score-item">
                <div>å½“å‰å¾—åˆ†: <span id="currentScore">0</span></div>
            </div>
            <div class="score-item">
                <div>å†å²æœ€é«˜: <span id="highScore">0</span></div>
            </div>
            <div class="score-item">
                <div>å½“å‰é•¿åº¦: <span id="snakeLength">1</span></div>
            </div>
        </div>

        <div class="game-status" id="gameStatus">ç‚¹å‡»å¼€å§‹æ¸¸æˆ</div>

        <canvas id="gameCanvas" width="400" height="400"></canvas>

        <div class="controls">
            <button id="startButton" class="control-button">ğŸ® å¼€å§‹æ¸¸æˆ</button>
            <button id="pauseButton" class="control-button" disabled>â¸ï¸ æš‚åœæ¸¸æˆ</button>
            <button id="restartButton" class="control-button">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>

        <div class="instructions">
            <h3>ğŸ¯ æ¸¸æˆè¯´æ˜</h3>
            <p>
                <strong>ç”µè„‘ç«¯ï¼š</strong>ä½¿ç”¨æ–¹å‘é”® â†‘â†“â†â†’ æ§åˆ¶è›‡çš„ç§»åŠ¨<br>
                <strong>æ‰‹æœºç«¯ï¼š</strong>æ»‘åŠ¨å±å¹•æ§åˆ¶æ–¹å‘<br>
                <strong>ç›®æ ‡ï¼š</strong>åƒåˆ°é£Ÿç‰©è®©è›‡å˜é•¿ï¼Œé¿å…æ’åˆ°å¢™å£æˆ–è‡ªå·±<br>
                <strong>æç¤ºï¼š</strong>æ¯åƒ10ä¸ªé£Ÿç‰©é€Ÿåº¦ä¼šåŠ å¿«ä¸€äº›
            </p>
        </div>
    </div>

    <script>
        // æˆå°±ç³»ç»Ÿå¸¸é‡
        const ACH_SNAKE_PLAY = 'dragonSnakePlayAchievementShown';
        const ACH_SNAKE_SCORE = 'dragonSnakeScoreAchievementShown';

        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = this.canvas.width / this.gridSize;
                
                // æ¸¸æˆçŠ¶æ€
                this.snake = [{x: 10, y: 10}];
                this.food = {x: 15, y: 15};
                this.direction = {x: 0, y: 0};
                this.score = 0;
                this.gameRunning = false;
                this.gamePaused = false;
                this.gameLoop = null;
                this.gameSpeed = 300;
                
                this.init();
            }
            
            init() {
                this.loadHighScore();
                this.generateFood();
                this.render();
                this.setupControls();
                this.updateStatus("ç‚¹å‡»å¼€å§‹æ¸¸æˆ");
            }
            
            generateFood() {
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
            }
            
            render() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.fillStyle = '#111';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶è›‡èº«
                this.ctx.fillStyle = '#4CAF50';
                for (let i = 1; i < this.snake.length; i++) {
                    this.ctx.fillRect(
                        this.snake[i].x * this.gridSize + 1,
                        this.snake[i].y * this.gridSize + 1,
                        this.gridSize - 2,
                        this.gridSize - 2
                    );
                }
                
                // ç»˜åˆ¶è›‡å¤´
                if (this.snake.length > 0) {
                    this.ctx.fillStyle = '#66BB6A';
                    this.ctx.fillRect(
                        this.snake[0].x * this.gridSize + 1,
                        this.snake[0].y * this.gridSize + 1,
                        this.gridSize - 2,
                        this.gridSize - 2
                    );
                }
                
                // ç»˜åˆ¶é£Ÿç‰©
                this.ctx.fillStyle = '#FF5722';
                this.ctx.beginPath();
                this.ctx.arc(
                    this.food.x * this.gridSize + this.gridSize / 2,
                    this.food.y * this.gridSize + this.gridSize / 2,
                    this.gridSize / 2 - 2,
                    0,
                    2 * Math.PI
                );
                this.ctx.fill();
                
                // æ›´æ–°UI
                document.getElementById('currentScore').textContent = this.score;
                document.getElementById('snakeLength').textContent = this.snake.length;
            }
            
            move() {
                if (!this.gameRunning || this.gamePaused || (this.direction.x === 0 && this.direction.y === 0)) {
                    return;
                }
                
                const head = {
                    x: this.snake[0].x + this.direction.x,
                    y: this.snake[0].y + this.direction.y
                };
                
                // æ£€æŸ¥å¢™å£ç¢°æ’
                if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                    this.gameOver();
                    return;
                }
                
                // æ£€æŸ¥è‡ªèº«ç¢°æ’
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }
                
                this.snake.unshift(head);
                
                // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += 10;
                    this.generateFood();
                    
                    // æ¯åƒ10ä¸ªé£Ÿç‰©åŠ é€Ÿ
                    if (this.score % 100 === 0 && this.gameSpeed > 150) {
                        this.gameSpeed -= 20;
                        this.startGameLoop();
                    }
                    
                    this.checkAchievements();
                } else {
                    this.snake.pop();
                }
                
                this.render();
            }
            
            startGame() {
                if (this.gameRunning && !this.gamePaused) return;
                
                if (!this.gameRunning) {
                    this.resetGame();
                    this.unlockFirstPlayAchievement();
                }
                
                this.gameRunning = true;
                this.gamePaused = false;
                this.startGameLoop();
                this.updateStatus("æ¸¸æˆè¿›è¡Œä¸­ - ä½¿ç”¨æ–¹å‘é”®æ§åˆ¶");
                
                document.getElementById('startButton').disabled = true;
                document.getElementById('pauseButton').disabled = false;
            }
            
            startGameLoop() {
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                }
                this.gameLoop = setInterval(() => this.move(), this.gameSpeed);
            }
            
            pauseGame() {
                if (!this.gameRunning) return;
                
                this.gamePaused = !this.gamePaused;
                
                if (this.gamePaused) {
                    clearInterval(this.gameLoop);
                    this.updateStatus("æ¸¸æˆæš‚åœ");
                    document.getElementById('pauseButton').textContent = 'â–¶ï¸ ç»§ç»­æ¸¸æˆ';
                } else {
                    this.startGameLoop();
                    this.updateStatus("æ¸¸æˆè¿›è¡Œä¸­ - ä½¿ç”¨æ–¹å‘é”®æ§åˆ¶");
                    document.getElementById('pauseButton').textContent = 'â¸ï¸ æš‚åœæ¸¸æˆ';
                }
            }
            
            resetGame() {
                this.gameRunning = false;
                this.gamePaused = false;
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                    this.gameLoop = null;
                }
                
                this.snake = [{x: 10, y: 10}];
                this.direction = {x: 0, y: 0};
                this.score = 0;
                this.gameSpeed = 300;
                
                this.generateFood();
                this.render();
                this.updateStatus("ç‚¹å‡»å¼€å§‹æ¸¸æˆ");
                
                document.getElementById('startButton').disabled = false;
                document.getElementById('pauseButton').disabled = true;
                document.getElementById('pauseButton').textContent = 'â¸ï¸ æš‚åœæ¸¸æˆ';
            }
            
            gameOver() {
                this.gameRunning = false;
                this.gamePaused = false;
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                    this.gameLoop = null;
                }
                
                this.saveHighScore();
                this.updateStatus(`æ¸¸æˆç»“æŸï¼å¾—åˆ†: ${this.score} ${this.score > parseInt(document.getElementById('highScore').textContent) ? 'ğŸ‰ æ–°çºªå½•ï¼' : ''}`);
                
                document.getElementById('startButton').disabled = false;
                document.getElementById('pauseButton').disabled = true;
            }
            
            updateStatus(message) {
                document.getElementById('gameStatus').textContent = message;
            }
            
            setupControls() {
                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    if (!this.gameRunning || this.gamePaused) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            if (this.direction.y !== 1) {
                                this.direction = {x: 0, y: -1};
                            }
                            break;
                        case 'ArrowDown':
                            if (this.direction.y !== -1) {
                                this.direction = {x: 0, y: 1};
                            }
                            break;
                        case 'ArrowLeft':
                            if (this.direction.x !== 1) {
                                this.direction = {x: -1, y: 0};
                            }
                            break;
                        case 'ArrowRight':
                            if (this.direction.x !== -1) {
                                this.direction = {x: 1, y: 0};
                            }
                            break;
                    }
                    e.preventDefault();
                });
                
                // è§¦æ‘¸æ§åˆ¶
                let touchStartX = 0;
                let touchStartY = 0;
                
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!this.gameRunning || this.gamePaused) return;
                    
                    const touch = e.changedTouches[0];
                    const deltaX = touch.clientX - touchStartX;
                    const deltaY = touch.clientY - touchStartY;
                    
                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        if (deltaX > 30 && this.direction.x !== -1) {
                            this.direction = {x: 1, y: 0};
                        } else if (deltaX < -30 && this.direction.x !== 1) {
                            this.direction = {x: -1, y: 0};
                        }
                    } else {
                        if (deltaY > 30 && this.direction.y !== -1) {
                            this.direction = {x: 0, y: 1};
                        } else if (deltaY < -30 && this.direction.y !== 1) {
                            this.direction = {x: 0, y: -1};
                        }
                    }
                });
                
                // æŒ‰é’®æ§åˆ¶
                document.getElementById('startButton').onclick = () => this.startGame();
                document.getElementById('pauseButton').onclick = () => this.pauseGame();
                document.getElementById('restartButton').onclick = () => this.resetGame();
            }
            
            saveHighScore() {
                const currentHigh = parseInt(localStorage.getItem('snakeHighScore') || '0');
                if (this.score > currentHigh) {
                    localStorage.setItem('snakeHighScore', this.score.toString());
                    this.loadHighScore();
                }
            }
            
            loadHighScore() {
                const highScore = localStorage.getItem('snakeHighScore') || '0';
                document.getElementById('highScore').textContent = highScore;
            }
            
            unlockFirstPlayAchievement() {
                if (localStorage.getItem(ACH_SNAKE_PLAY) !== 'true') {
                    localStorage.setItem(ACH_SNAKE_PLAY, 'true');
                }
            }
            
            checkAchievements() {
                if (this.score >= 500 && localStorage.getItem(ACH_SNAKE_SCORE) !== 'true') {
                    localStorage.setItem(ACH_SNAKE_SCORE, 'true');
                }
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        let game;
        window.onload = () => {
            game = new SnakeGame();
        };
    </script>
</body>
</html>
